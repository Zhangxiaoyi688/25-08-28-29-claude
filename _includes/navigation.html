<nav class="main-navigation" role="navigation" aria-label="Main navigation">
    <ul class="nav-list">
        {% for item in site.navigation %}
            <li class="nav-item">
                <a href="{{ item.url | relative_url }}" 
                   class="nav-link {% if page.url == item.url or (item.url != '/' and page.url contains item.url) %}active{% endif %}"
                   {% if item.url contains 'http' %}target="_blank" rel="noopener"{% endif %}>
                    {{ item.name }}
                </a>
            </li>
        {% endfor %}
    </ul>
</nav>

<!-- Breadcrumb Navigation -->
{% unless page.url == '/' %}
<nav class="breadcrumb-nav" aria-label="Breadcrumb">
    <div class="container">
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="{{ '/' | relative_url }}">
                    <i data-feather="home"></i>
                    Home
                </a>
            </li>
            
            {% assign url_parts = page.url | split: '/' %}
            {% assign current_path = '' %}
            
            {% for part in url_parts %}
                {% unless part == '' %}
                    {% assign current_path = current_path | append: '/' | append: part %}
                    {% if forloop.last %}
                        <li class="breadcrumb-item active" aria-current="page">
                            {{ page.title | default: part | capitalize }}
                        </li>
                    {% else %}
                        <li class="breadcrumb-item">
                            <a href="{{ current_path | relative_url }}">{{ part | capitalize }}</a>
                        </li>
                    {% endif %}
                {% endunless %}
            {% endfor %}
        </ol>
    </div>
</nav>
{% endunless %}

<!-- Publications Filter Navigation (for publications page) -->
{% if page.url contains 'publications' %}
<nav class="filter-nav" aria-label="Filter publications">
    <div class="container">
        <div class="filter-controls">
            <div class="filter-group">
                <label for="type-filter">Filter by type:</label>
                <select id="type-filter" class="filter-select">
                    <option value="all">All Types</option>
                    {% for type in site.research_types %}
                        <option value="{{ type.type }}">{{ type.name }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="filter-group">
                <label for="year-filter">Filter by year:</label>
                <select id="year-filter" class="filter-select">
                    <option value="all">All Years</option>
                    {% assign years = site.research | map: 'date' | map: 'year' | uniq | sort | reverse %}
                    {% for year in years %}
                        <option value="{{ year }}">{{ year }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="filter-group">
                <label for="sort-filter">Sort by:</label>
                <select id="sort-filter" class="filter-select">
                    <option value="date-desc">Newest First</option>
                    <option value="date-asc">Oldest First</option>
                    <option value="title-asc">Title A-Z</option>
                    <option value="title-desc">Title Z-A</option>
                </select>
            </div>
            
            <button id="clear-filters" class="btn btn-sm btn-outline">
                <i data-feather="x"></i>
                Clear Filters
            </button>
        </div>
    </div>
</nav>

<script>
// Publications filter functionality
document.addEventListener('DOMContentLoaded', function() {
    const typeFilter = document.getElementById('type-filter');
    const yearFilter = document.getElementById('year-filter');
    const sortFilter = document.getElementById('sort-filter');
    const clearFilters = document.getElementById('clear-filters');
    const publications = document.querySelectorAll('.publication-item');
    
    function filterPublications() {
        const selectedType = typeFilter.value;
        const selectedYear = yearFilter.value;
        const sortBy = sortFilter.value;
        
        let visiblePublications = Array.from(publications);
        
        // Filter by type
        if (selectedType !== 'all') {
            visiblePublications = visiblePublications.filter(pub => {
                return pub.dataset.type === selectedType;
            });
        }
        
        // Filter by year
        if (selectedYear !== 'all') {
            visiblePublications = visiblePublications.filter(pub => {
                return pub.dataset.year === selectedYear;
            });
        }
        
        // Hide all publications first
        publications.forEach(pub => pub.style.display = 'none');
        
        // Sort visible publications
        visiblePublications.sort((a, b) => {
            switch (sortBy) {
                case 'date-desc':
                    return new Date(b.dataset.date) - new Date(a.dataset.date);
                case 'date-asc':
                    return new Date(a.dataset.date) - new Date(b.dataset.date);
                case 'title-asc':
                    return a.dataset.title.localeCompare(b.dataset.title);
                case 'title-desc':
                    return b.dataset.title.localeCompare(a.dataset.title);
                default:
                    return 0;
            }
        });
        
        // Show and reorder visible publications
        const container = publications[0]?.parentNode;
        if (container) {
            visiblePublications.forEach((pub, index) => {
                pub.style.display = 'block';
                pub.style.order = index;
            });
        }
        
        // Update results count
        updateResultsCount(visiblePublications.length);
    }
    
    function updateResultsCount(count) {
        let resultsCount = document.querySelector('.results-count');
        if (!resultsCount) {
            resultsCount = document.createElement('div');
            resultsCount.className = 'results-count';
            document.querySelector('.filter-nav .container').appendChild(resultsCount);
        }
        resultsCount.textContent = `Showing ${count} publication${count !== 1 ? 's' : ''}`;
    }
    
    function clearAllFilters() {
        typeFilter.value = 'all';
        yearFilter.value = 'all';
        sortFilter.value = 'date-desc';
        filterPublications();
    }
    
    // Event listeners
    if (typeFilter) typeFilter.addEventListener('change', filterPublications);
    if (yearFilter) yearFilter.addEventListener('change', filterPublications);
    if (sortFilter) sortFilter.addEventListener('change', filterPublications);
    if (clearFilters) clearFilters.addEventListener('click', clearAllFilters);
    
    // Initial filter
    filterPublications();
});
</script>
{% endif %}